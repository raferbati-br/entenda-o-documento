# C2 - Containers

## Containers
- Web App (Next.js App Router)
- API Routes (Next.js, Node runtime)
- Provedores LLM (OpenAI, Gemini, Mock)
- Redis (Upstash) para armazenamento de capturas, rate limit e contadores agregados
- PostHog (opcional) para eventos de telemetria
- Armazenamento no cliente (IndexedDB + sessionStorage)

## Diagrama
```mermaid
flowchart TB
  %% Camadas
  subgraph Browser[Browser]
    UI[Next.js UI]
    Storage[(IndexedDB / sessionStorage)]
  end

  subgraph Server[Server]
    API[Next.js API Routes]
    Memory[(In-memory store - dev fallback)]
    Redis[(Redis / Upstash)]
  end

  LLM[(Provedores LLM)]
  PostHog[(PostHog - optional)]

  %% Fluxos
  UI -->|dados da imagem| API
  API --> Redis
  API --> Memory
  API -->|imagem + prompt| LLM
  API -->|resultado| UI
  UI --> Storage
  UI -->|eventos de telemetria| PostHog

  %% Cores
  classDef browser fill:#e8f1ff,stroke:#3b82f6,stroke-width:1px,color:#111827;
  classDef server fill:#ecfeff,stroke:#06b6d4,stroke-width:1px,color:#164e63;
  classDef store fill:#ecfdf3,stroke:#10b981,stroke-width:1px,color:#065f46;
  classDef external fill:#fff7ed,stroke:#f97316,stroke-width:1px,color:#9a3412;

  class UI browser;
  class Storage store;
  class API,Memory,Redis server;
  class LLM,PostHog external;
```
