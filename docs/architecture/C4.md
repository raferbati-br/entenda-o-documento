# C4 - Code (Key Flows)

## Flow: Capture -> Analyze -> Result
1) App requests a short-lived token from /api/session-token.
2) User selects a photo and confirms.
3) /api/capture validates base64, checks origin/token, and stores in Redis with a TTL (memory fallback in dev).
4) /api/analyze checks origin/token, fetches image from Redis, and calls analyzeDocument.
5) analyzeDocument calls provider (OpenAI) and postprocess.
6) Result is saved in sessionStorage and rendered in /result.

## Key Files
- src/app/api/capture/route.ts
- src/app/api/analyze/route.ts
- src/app/api/session-token/route.ts
- src/ai/analyzeDocument.ts
- src/ai/providers/openaiProvider.ts
- src/ai/postprocess.ts
- src/lib/captureStoreServer.ts
- src/lib/captureStore.ts
- src/lib/resultStore.ts
- src/lib/requestAuth.ts
- src/lib/sessionToken.ts
