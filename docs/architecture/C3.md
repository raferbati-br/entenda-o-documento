# C3 - Components

## Server Components (API Routes)
- /api/session-token: issues short-lived session token
- /api/capture: validates and stores image data (short TTL)
- /api/ocr: loads image data and extracts document text (OCR via LLM)
- /api/analyze: loads image data and calls AI pipeline
- /api/qa: answers questions based on extracted context
- /api/feedback: stores aggregated user feedback
- /api/health: simple health check

## AI Pipeline Components
- Prompt registry (src/ai/prompts)
- Provider adapter (src/ai/providers)
- Postprocess and safety softening (src/ai/postprocess.ts)
- OCR extraction (src/ai/extractDocumentText.ts)
- Q&A answering (src/ai/answerQuestion.ts)

## Diagram
```mermaid
flowchart LR
  Capture[/api/capture/] --> Store[(Capture Store)]
  Ocr[/api/ocr/] --> Store
  Analyze[/api/analyze/] --> Store
  Feedback[/api/feedback/] --> FeedbackStore[(Feedback Counters)]
  Qa[/api/qa/] --> QaFlow[answerQuestion]
  QaFlow --> QaPrompt[getQaPrompt]
  QaFlow --> Provider
  Ocr --> OcrFlow[extractDocumentText]
  OcrFlow --> OcrPrompt[getOcrPrompt]
  OcrFlow --> Provider
  Analyze --> AnalyzeDoc[analyzeDocument]
  AnalyzeDoc --> Prompt[getPrompt]
  AnalyzeDoc --> Provider[getProvider -> OpenAI]
  AnalyzeDoc --> Postprocess[postprocess]
```
